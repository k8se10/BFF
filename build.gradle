plugins {
    id 'fabric-loom' version '1.6.12'
    id 'maven-publish'
}

group = 'net.mod.buildcraft'
version = '0.1.0+1.20.4'
archivesBaseName = 'buildcraft-fabric'

java {
    toolchain { languageVersion = JavaLanguageVersion.of(17) }
    withSourcesJar()
}

repositories {
    mavenCentral()
    maven { url = 'https://maven.fabricmc.net/' }
    maven { url = 'https://maven.terraformersmc.com/releases/' }
    maven { url = 'https://repo.spongepowered.org/repository/maven-public/' } // optional
}

dependencies {
    minecraft "com.mojang:minecraft:1.20.4"

    // Keep it simple: use Yarn directly (layered mappings optional, not required)
    mappings "net.fabricmc:yarn:1.20.4+build.3:v2"

    modImplementation "net.fabricmc:fabric-loader:0.15.10"
    modImplementation "net.fabricmc.fabric-api:fabric-api:0.97.0+1.20.4"

    // MixinExtras
    modImplementation "io.github.llamalad7:mixinextras-fabric:0.3.2"
    annotationProcessor "io.github.llamalad7:mixinextras-common:0.3.2"
}

loom {
    silentMojangMappingsLicense()
    mixin {
        defaultRefmapName = "buildcraft-fabric.refmap.json"
    }
}

tasks.withType(JavaCompile).configureEach {
    options.release = 17
}

jar {
    from("LICENSE") {
        rename { "LICENSE_${archivesBaseName}" }
    }
}

// Make 'build' produce a remapped mod jar in CI
tasks.named("build") {
    dependsOn("remapJar")
}
